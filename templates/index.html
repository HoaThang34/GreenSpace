<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Tr√≤ chuy·ªán</title>
  <!-- Fonts v√† style c∆° b·∫£n -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/static/style.css" />
  <link rel="stylesheet" href="/static/motion.css" />
  <script>
    // L·ªùi ch√†o thu·∫ßn Vi·ªát ƒë∆∞·ª£c script client s·ª≠ d·ª•ng ƒë·ªÉ t·∫°o tin nh·∫Øn gi·ªõi thi·ªáu
    window.GREETING = "Xin ch√†o, m√¨nh l√† Solace. H√£y coi m√¨nh nh∆∞ m·ªôt khu v∆∞·ªùn y√™n tƒ©nh ƒë·ªÉ nh·ªØng suy nghƒ© c·ªßa b·∫°n ƒë∆∞·ª£c n·∫£y m·∫ßm.\n\nƒê·ªÉ b·∫Øt ƒë·∫ßu, b·∫°n c·∫ßn m·ªôt ng∆∞·ªùi b·∫°n nh∆∞ th·∫ø n√†o ngay l√∫c n√†y ‚Äì m·ªôt ng∆∞·ªùi nh·∫π nh√†ng l·∫Øng nghe, hay m·ªôt ng∆∞·ªùi th·∫≥ng th·∫Øn h∆°n m·ªôt ch√∫t?";
  </script>
</head>
<body class="chat-page-body">
  <!-- Thanh ·ª©ng d·ª•ng tr√™n c√πng: th∆∞∆°ng hi·ªáu + ƒëi·ªÅu khi·ªÉn ng∆∞·ªùi d√πng -->
  <header class="appbar fx-reveal">
    <div class="brand">
      <span class="logo">üå±</span>
      <div>
        <span class="brand-title">Solace</span>
        <div class="brand-tagline">N∆°i T√¢m H·ªìn T√¨m Th·∫•y S·ª± An ·ª¶i</div>
      </div>
    </div>

    <!-- V√πng ƒëi·ªÅu khi·ªÉn (bi·∫øn th√†nh menu tr√™n di ƒë·ªông qua CSS/JS) -->
    <nav class="controls-container" id="controlsContainer">
      <div class="controls">
        <!-- Navigation ch√≠nh cho Chatbot -->
        <button class="chip btn-emergency fx-pulse-emergency" id="emergencyBtn">üìû H·ªó tr·ª£ kh·∫©n c·∫•p</button>
        <button class="chip" id="newChatBtn">‚ûï Tr√≤ chuy·ªán m·ªõi</button>
        <button class="chip" id="themeToggle">Ch·∫ø ƒë·ªô t·ªëi</button>
        <button class="chip" id="statsBtn">L·ªãch s·ª≠ c·∫£m x√∫c</button>
        <button class="chip" id="historyBtn">L·ªãch s·ª≠</button>
        
        <!-- Separator v√† link sang C·ªông ƒë·ªìng -->
        <div style="width: 1px; height: 24px; background: var(--border); margin: 0 8px;"></div>
        <a href="/community" class="chip" style="background: var(--mood-joy); color: white;">C·ªông ƒë·ªìng</a>
        
        <!-- User menu -->
        <div class="user-menu">
          <button class="chip user-chip" id="userChip">
            <span id="displayName">{{ display_name }}</span> ‚ñº
          </button>
          <div class="dropdown-menu" id="dropdownMenu">
            <a href="/profile/{{ username }}" id="myProfileBtn">H·ªì s∆° c·ªßa t√¥i</a>
            <a href="/friends" id="friendsMenuLink">B·∫°n b√®</a>
            <a href="/messages" id="messagesMenuLink">Tin nh·∫Øn <span id="unreadBadgeMenu" style="display:none; background:var(--mood-anger); color:white; border-radius:50%; width:18px; height:18px; display:inline-flex; align-items:center; justify-content:center; font-size:0.75rem; margin-left:4px;">0</span></a>
            <div style="height: 1px; background: var(--border); margin: 8px 0;"></div>
            <a href="#" id="changePasswordBtn">ƒê·ªïi m·∫≠t kh·∫©u</a> 
            <a href="#" id="logoutBtn">ƒêƒÉng xu·∫•t</a>
          </div>
        </div>
      </div>
    </nav>

    <!-- N√∫t ch·ªâ d√†nh cho di ƒë·ªông ƒë·ªÉ b·∫≠t/t·∫Øt menu ƒëi·ªÅu khi·ªÉn -->
    <button class="chip mobile-menu-btn" id="mobileMenuBtn">‚ò∞</button>
  </header>

  <!-- N·ªôi dung chat ch√≠nh: qu·∫£ c·∫ßu c·∫£m x√∫c + danh s√°ch tin nh·∫Øn -->
  <main class="chat-container">
    <div class="mood-orb-container">
      <div id="moodOrb" class="mood-orb"></div>
    </div>
    <div id="chat" class="chat-area">
      <!-- Tin nh·∫Øn tr√≤ chuy·ªán s·∫Ω ƒë∆∞·ª£c th√™m v√†o ƒë√¢y b·ªüi /static/app.js -->
    </div>
  </main>

  <!-- V√πng so·∫°n th·∫£o v·ªõi textarea + n√∫t g·ª≠i; footer c≈©ng hi·ªÉn th·ªã watermark -->
  <footer class="composer-area fx-reveal">
    <!--<div class="watermark">¬© H√≤a Quang Th·∫Øng - Tr∆∞·ªùng THPT Chuy√™n Nguy·ªÖn T·∫•t Th√†nh, T·ªânh L√†o Cai</div> --->
    <div class="composer">
      <textarea id="inp" placeholder="Chia s·∫ª ƒëi·ªÅu b·∫°n ƒëang nghƒ©‚Ä¶ (Enter ƒë·ªÉ g·ª≠i)" rows="1"></textarea>
      <!-- (M·ªöI) N√∫t Ghi √Çm -->
      <button id="micBtn" class="mic-btn" title="Nh·∫≠p b·∫±ng gi·ªçng n√≥i">
          <i class="fas fa-microphone"></i>
      </button>
      <button id="send" class="send">‚û§</button>
    </div>
</footer>

  <!-- C√°c dialog modal cho ph·∫ßn gi·ªõi thi·ªáu, l·ªãch s·ª≠, v√† th·ªëng k√™ -->
  <div class="modal show" id="intro">
    <div class="panel center fx-reveal">
      <h1>Ch√†o m·ª´ng ƒë·∫øn v·ªõi <b>Solace</b></h1>
      <div class="muted">
        M·ªói h√†nh tr√¨nh ch·ªØa l√†nh ƒë·ªÅu b·∫Øt ƒë·∫ßu t·ª´ nh·ªØng b∆∞·ªõc nh·ªè. <br>
        H√£y gieo m·ªôt h·∫°t m·∫ßm nh·ªè cho t√¢m h·ªìn b·∫°n. <br>
      </div>
      <div class="actions">
        <button class="btn primary fx-pulse" id="start">B·∫Øt ƒë·∫ßu</button>
      </div>
    </div>
  </div>

  <!-- Modal H·ªó Tr·ª£ Kh·∫©n C·∫•p -->
  <div class="modal" id="emergencyModal">
    <div class="panel center">
      <h1 style="color: var(--mood-anger);">T√¨m S·ª± Gi√∫p ƒê·ª° Ngay L·∫≠p T·ª©c</h1>
      <div class="muted" style="font-size: 1rem; line-height: 1.7;">
          N·∫øu b·∫°n ƒëang c·∫£m th·∫•y kh·ªßng ho·∫£ng ho·∫∑c nghƒ© ƒë·∫øn vi·ªác l√†m h·∫°i b·∫£n th√¢n, xin h√£y bi·∫øt r·∫±ng c√≥ nh·ªØng ng∆∞·ªùi s·∫µn s√†ng l·∫Øng nghe v√† gi√∫p ƒë·ª°.
          <br>
          <b>Solace kh√¥ng ph·∫£i l√† d·ªãch v·ª• y t·∫ø hay c·ª©u tr·ª£ kh·∫©n c·∫•p.</b>
          <br>
          H√£y li√™n h·ªá v·ªõi c√°c chuy√™n gia qua nh·ªØng s·ªë ƒëi·ªán tho·∫°i d∆∞·ªõi ƒë√¢y:
      </div>
      <div class="actions" style="flex-direction: column; gap: 15px; margin-top: 30px;">
        <!-- N√∫t g·ªçi T·ªïng ƒë√†i Qu·ªëc gia B·∫£o v·ªá Tr·∫ª em (v√† t∆∞ v·∫•n t√¢m l√Ω) -->
        <a href="tel:111" class="btn primary" style="width: 100%; background: var(--mood-joy); border-color: var(--mood-joy);">
          <b>G·ªçi 111</b>
          <div style="font-weight: normal; font-size: 0.8rem;">T·ªïng ƒë√†i B·∫£o v·ªá Tr·∫ª em & T∆∞ v·∫•n t√¢m l√Ω</div>
        </a>
        <!-- N√∫t g·ªçi C·∫•p c·ª©u y t·∫ø -->
        <a href="tel:115" class="btn primary" style="width: 100%;">
          <b>G·ªçi 115</b>
          <div style="font-weight: normal; font-size: 0.8rem;">C·∫•p c·ª©u y t·∫ø kh·∫©n c·∫•p</div>
        </a>
      </div>
      <div class="actions">
          <button id="emergencyCloseBtn" class="btn" style="margin-top: 20px;">ƒê√≥ng c·ª≠a s·ªï n√†y</button>
      </div>
    </div>
  </div>

  <div class="modal" id="histModal">
    <div class="panel">
      <div class="histbar">
        <input id="histSearch" placeholder="T√¨m ki·∫øm theo ti√™u ƒë·ªÅ..." />
        <button id="histClose" class="btn">ƒê√≥ng</button>
      </div>
      <div id="histList" class="histlist"></div>
    </div>
  </div>

  <div class="modal" id="statsModal">
    <div class="panel">
      <div class="histbar">
        <h2>Th·ªëng k√™ C·∫£m x√∫c Phi√™n</h2>
        <button id="statsClose" class="btn">ƒê√≥ng</button>
      </div>
      <div class="chart-container" style="height: 350px; position: relative;">
        <canvas id="emotionChart"></canvas>
      </div>
    </div>
  </div>

  <!-- Modal ƒê·ªïi M·∫≠t Kh·∫©u -->
  <div class="modal" id="changePasswordModal">
    <div class="panel">
      <div class="histbar">
        <h2>ƒê·ªïi M·∫≠t Kh·∫©u</h2>
        <button id="changePassClose" class="btn">ƒê√≥ng</button>
      </div>
      <form id="changePasswordForm" style="margin-top: 20px;">
        <div class="form-group" style="margin: 16px 0;">
          <label for="oldPass" style="display: block; margin-bottom: 6px;">M·∫≠t kh·∫©u c≈©</label>
          <input id="oldPass" type="password" required style="width: 100%; padding: 12px; border-radius: 12px; font-size: 1rem; border: 2px solid var(--border); background: var(--input-bg); color: var(--fg);">
        </div>
        <div class="form-group" style="margin: 16px 0;">
          <label for="newPass" style="display: block; margin-bottom: 6px;">M·∫≠t kh·∫©u m·ªõi</label>
          <input id="newPass" type="password" required style="width: 100%; padding: 12px; border-radius: 12px; font-size: 1rem; border: 2px solid var(--border); background: var(--input-bg); color: var(--fg);">
        </div>
        <div class="form-group" style="margin: 16px 0;">
          <label for="newPassConfirm" style="display: block; margin-bottom: 6px;">X√°c nh·∫≠n m·∫≠t kh·∫©u m·ªõi</label>
          <input id="newPassConfirm" type="password" required style="width: 100%; padding: 12px; border-radius: 12px; font-size: 1rem; border: 2px solid var(--border); background: var(--input-bg); color: var(--fg);">
        </div>
        <button type="submit" class="btn primary" style="width: 100%; margin-top: 10px;">C·∫≠p nh·∫≠t m·∫≠t kh·∫©u</button>
      </form>
      <p id="changePassMessage" class="muted" style="margin-top: 15px; min-height: 1em; text-align: center;"></p>
    </div>
  </div>

  <!-- Script client (render Markdown, l√†m s·∫°ch, bi·ªÉu ƒë·ªì, v√† logic ·ª©ng d·ª•ng) -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.6/dist/purify.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="/static/app.js"></script>
  <script src="/static/theme.js"></script>
  <script src="/static/motion.js"></script>
</body>
</html>